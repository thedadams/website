<!doctype html>
<html>
<head>
	<?php
	/* This script takes the post using the $_GET variable and displays it to the user.
	* It is robust in that it checks to make sure the post exists and that the $_GET
	* variable has not be tampered with.  Note that the script assumes that the first
	* line of the file is the title of the post.
	*/
	include_once "php/Post.php";
	include_once "php/Archive.php";
	date_default_timezone_set("America/Phoenix");
	$error = false;
	$postString = $_GET["post"];
	if (strlen(utf8_decode($postString)) > 12 && checkdate(substr($postString, 5, 2), substr($postString, 11), substr($postString, 0, 4)) && file_exists("Posts/" . str_replace("-", "/", $postString))) {
		$displayPost = new Post(substr($postString, 0, 5) . substr($postString, 5, 2) . substr($postString, 10), date_create("@" . filemtime("Posts/" . str_replace("-", "/", $postString)))->format("Y/m/d"));
		$file = fopen("Posts/" . str_replace("-","/", $postString)	,"r");
		$displayPost->setTitle(trim(fgets($file)));
		while(!feof($file)) {
			$nextLine = fgets($file);
			if(strpos($nextLine, "#tags:") === false) {
				$displayPost->appendToBody($nextLine);
			} else {
				$nextLine = substr($nextLine, 6);
				$displayPost->setTags(explode(",", $nextLine));
			}
		}
		fclose($file);
	} else {
		$displayPost = new Post("now","now");
		$error = true;
	}
	?>
	<title>thedadams - <?php echo $displayPost->getTitle() . " - " . $displayPost->getDateCreated()->format("Y/m/d");?></title>
	<meta name="description" content="Donnie Adams' Blog">
	<meta name="keywords" content="donald, donnie, adams, math, blog, baseball, basketball, school, college, teaching">
	<meta property="og:image" content="images/thedadams.png"/>
	<meta charset="UTF-8">
	<link rel="shortcut icon" href="favicon.ico"/>
	<link rel="apple-touch-icon" href="images/iphone-icon.png"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<link rel="stylesheet" type="text/css" media="screen and (max-width: 650px)" href="stylesheets/mobilescreen.css"/>
	<link rel="stylesheet" type="text/css" media="screen and (min-width: 651px)" href="stylesheets/screen.css"/>
	<link rel="alternate" href="/feed.rss" type="application/rss+xml" title="RSS Feed"/>
	<link rel="stylesheet" type="text/css" href="magnific-popup/magnific-popup.css"/>
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="magnific-popup/jquery.magnific-popup.js"></script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(["setCookieDomain", "*.thedadams.com"]);
  _paq.push(["setDomains", ["*.thedadams.com/piwik"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//thedadams.com/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//thedadams.com/piwik/piwik.php?idsite=1&rec=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
</head>

<body>
	<div id="container">
		<?php
		include "header.html";
		?>
		<div class="header-clear"></div>
		<section class="left">
			<?php
			if ($error) {
				echo "<h2>I'm sorry, but it seems that you are trying to access a post that does not exists.  It may be because you altered the URL above or because the post you are trying to view has been moved.  If you believe you have reached this in error, please contact me via <a href=\"https://alpha.app.net/thedadams\" title=\"App.net\">App.net</a> or <a href=\"https://twitter.com/thedadams\">Twitter</a>.</h2>";
			} else {
				echo "<br><h2>" . $displayPost->getTitle() . "</h2>";
				echo "<p><span>Posted on " . $displayPost->getDateCreated()->format("m/d/Y"). "</span></p>";
				echo $displayPost->getBody();
				echo "<p>Tags: " . getTagStringFromArray($displayPost->getTags(), "Archive.html?tag=") . "<br>";
				echo "<span>Updated on " . $displayPost->getDateUpdated()->format("m/d/Y") . "</span><br><br><br></p>";
}
?>
</section>
<section class="right">
	<?php
	date_default_timezone_set("America/Phoenix");
	include "BlogRight.html";
	?>
</div>
<div class="footer-clear"></div>
</div>
<footer><a href="BlogCredits.html" title="Blog Credits">Credits &amp; Acknowledgments</a><div class="footercolor"></footer>
</div>
</body>
</html>
